(this["webpackJsonptest-01"]=this["webpackJsonptest-01"]||[]).push([[0],{100:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),o=a.n(c),s=(a(91),a(143)),i=a(144),l=a(79),u=a(63),d=a(30),p=a(31),m=a(6),f=a.n(m),b=a(8),h=a(24),v=a(14),g=a(40),E=a(136),w=a(109),y=a(107),k=a(105),x=a(137),j=a(102),O=a(104),S=a(138),D=a(145),L=a(139),_=a(140),N=a(74),W=a.n(N),A=a(73),C=a.n(A),P=a(72),R={},T="orders",B={_id:"default",downloadDisabled:!1,downloadedAt:"",uploadDisabled:!0,uploadedAt:"",deleteDisabled:!0,deletedAt:""};function F(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T;return R[e]||(R[e]=new P.a(e)),R[e]}function U(){return I.apply(this,arguments)}function I(){return(I=Object(b.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F("sync-metadata").get("default");case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!e.t0||"not_found"!==e.t0.name){e.next=10;break}return e.abrupt("return",B);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function G(e){return H.apply(this,arguments)}function H(){return(H=Object(b.a)(f.a.mark((function e(t){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:return a=e.sent,n=a&&a._rev?Object(h.a)({},t,{_rev:a._rev}):t,e.next=6,F("sync-metadata").put(n);case 6:return e.next=8,F("sync-metadata").get("default");case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return M.apply(this,arguments)}function M(){return(M=Object(b.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(T).allDocs({include_docs:!0});case 2:return t=e.sent,e.abrupt("return",t.rows.map((function(e){return e.doc})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return $.apply(this,arguments)}function $(){return($=Object(b.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(T).get(t,{attachments:!0,binary:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return K.apply(this,arguments)}function K(){return(K=Object(b.a)(f.a.mark((function e(t){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.id&&(a=Object(h.a)({},t,{_id:t.id})),e.next=3,F(T).put(a);case 3:return n=e.sent,e.abrupt("return",z(n.id));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return V.apply(this,arguments)}function V(){return(V=Object(b.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(T).destroy();case 2:return(t=e.sent).ok&&(R[T]=null),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(b.a)(f.a.mark((function e(t,a){var n,r,c,o,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.name,r=a.type,e.next=3,F(T).get(t);case 3:return c=e.sent,o=c._rev,e.next=7,F(T).putAttachment(t,n,o,a,r);case 7:return s=e.sent,e.abrupt("return",z(s.id));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=Object(l.a)((function(e){return{root:{},inputFile:{display:"none"}}}));function ee(){var e=Z(),t=function(e){var t=Object(n.useState)(void 0),a=Object(v.a)(t,2),r=a[0],c=a[1],o=Object(n.useState)(!1),s=Object(v.a)(o,2),i=s[0],l=s[1],u=Object(n.useState)(!1),d=Object(v.a)(u,2),p=d[0],m=d[1];return Object(n.useEffect)((function(){function t(){return(t=Object(b.a)(f.a.mark((function t(){var a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l(!0),m(!1),t.prev=2,t.next=5,z(e);case 5:a=t.sent,c(a),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),m(!0);case 12:l(!1);case 13:case"end":return t.stop()}}),t,null,[[2,9]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),{data:r,isLoading:i,isError:p}}(Object(p.f)().id),a=t.data,c=t.isLoading,o=t.isError,s=Object(n.useState)(a),i=Object(v.a)(s,2),l=i[0],u=i[1];Object(n.useEffect)((function(){a&&a._attachments&&console.log(Object.keys(a._attachments)),u(a)}),[a]);var d=function(e){return function(t){console.log("Task: ",e.id,", done: ",t.target.checked),u(Object(h.a)({},l,{tasks:l.tasks.map((function(a){return e.id===a.id?Object(h.a)({},a,{done:t.target.checked}):a}))}))}},m=function(){var e=Object(b.a)(f.a.mark((function e(t){var a,n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=document.getElementById("icon-button-file")).files||!a.files[0]){e.next=8;break}return n=a.files[0],e.next=5,X(l._id,n);case 5:r=e.sent,u(r),console.log(r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,o&&r.a.createElement("div",null,"Something went wrong ..."),c&&r.a.createElement("div",null,"Loading..."),!c&&!a&&r.a.createElement(g.a,{variant:"subtitle1"},"Order not found"),l&&r.a.createElement(E.a,{container:!0,spacing:2},r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(g.a,{variant:"h5"},l.description)),r.a.createElement(E.a,{item:!0,container:!0,xs:12,direction:"row",justify:"flex-end"},r.a.createElement(E.a,{item:!0},r.a.createElement(w.a,{color:"primary",component:"span"},r.a.createElement(C.a,null)))),r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(y.a,{elevation:1},r.a.createElement(k.a,{subheader:r.a.createElement(x.a,null,"Tasks")},l.tasks.map((function(e){return r.a.createElement(j.a,{key:e.id},r.a.createElement(O.a,{primary:e.description}),r.a.createElement(S.a,null,r.a.createElement(D.a,{edge:"end",onChange:d(e),checked:e.done})))}))))),r.a.createElement(E.a,{item:!0,container:!0,xs:12,direction:"row",justify:"flex-end"},r.a.createElement(E.a,{item:!0},r.a.createElement("input",{type:"file",accept:"image/*",capture:!0,id:"icon-button-file",className:e.inputFile,onChange:m}),r.a.createElement("label",{htmlFor:"icon-button-file"},r.a.createElement(w.a,{color:"primary",component:"span"},r.a.createElement(W.a,null))))),r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(y.a,{elevation:1},r.a.createElement(L.a,{cellHeight:180,cols:3},r.a.createElement(_.a,{key:"Subheader",cols:3,style:{height:"auto"}},r.a.createElement(x.a,{component:"div"},"Pictures")),l._attachments&&Object.keys(l._attachments).map((function(e){return r.a.createElement(_.a,{key:e,cols:1},r.a.createElement("img",{src:URL.createObjectURL(l._attachments[e].data),alt:e}))})))))))}var te=a(75),ae=a.n(te);function ne(){var e=Object(p.g)().url,t=function(){var e=Object(n.useState)([]),t=Object(v.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)(!1),o=Object(v.a)(c,2),s=o[0],i=o[1],l=Object(n.useState)(!1),u=Object(v.a)(l,2),d=u[0],p=u[1];return Object(n.useEffect)((function(){function e(){return(e=Object(b.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),p(!1),e.prev=2,e.next=5,J();case 5:t=e.sent,r(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),p(!0);case 12:i(!1);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),{data:a,isLoading:s,isError:d}}(),a=t.data,c=t.isLoading,o=t.isError;return r.a.createElement("div",null,r.a.createElement(E.a,{container:!0,spacing:2},r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(g.a,{variant:"h5"},"Work Orders")),r.a.createElement(E.a,{item:!0,xs:12},o&&r.a.createElement("div",null,"Something went wrong ..."),c&&r.a.createElement("div",null,"Loading..."),!c&&0===a.length&&r.a.createElement(g.a,{variant:"subtitle1"},"No orders to display"),a.length>0&&r.a.createElement(y.a,{elevation:1},r.a.createElement(k.a,null,a.map((function(t){return r.a.createElement(j.a,{key:t.id,button:!0,component:d.b,to:"".concat(e,"/").concat(t.id)},r.a.createElement(O.a,{primary:t.description,secondary:t.station}),r.a.createElement(S.a,null,r.a.createElement(w.a,{color:"inherit"},r.a.createElement(ae.a,null))))})))))))}function re(){var e=Object(p.g)().path;return r.a.createElement(p.c,null,r.a.createElement(p.a,{exact:!0,path:e},r.a.createElement(ne,null)),r.a.createElement(p.a,{path:"".concat(e,"/:id")},r.a.createElement(ee,null)))}var ce=a(141),oe=a(142),se=a(77),ie=a.n(se),le=a(76),ue=a.n(le),de=a(78),pe=a.n(de);function me(){return fe.apply(this,arguments)}function fe(){return(fe=Object(b.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://tp-poc-api.herokuapp.com/api/orders");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){return he.apply(this,arguments)}function he(){return(he=Object(b.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://tp-poc-api.herokuapp.com/api/orders/".concat(t));case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ve=Object(l.a)((function(e){return{root:{},button:{marginRight:e.spacing(2)}}}));function ge(){var e=ve(),t=Object(n.useState)(B),a=Object(v.a)(t,2),c=a[0],o=a[1];Object(n.useEffect)((function(){function e(){return(e=Object(b.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U();case 3:t=e.sent,o(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s=Object(n.useState)({loading:!1,message:"",err:!1}),i=Object(v.a)(s,2),l=i[0],u=i[1],d=function(){var e=Object(b.a)(f.a.mark((function e(t){var a,n,r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u({loading:!0,message:"Loading work orders from server"}),e.prev=1,e.next=4,me();case 4:if(!((a=e.sent).length>0)){e.next=23;break}return u({message:"Loading tasks for ".concat(a.length," work orders from server")}),e.next=9,Promise.all(a.map((function(e){return be(e.id)})));case 9:return n=e.sent,u({message:"Saving work orders to local database"}),e.next=13,Promise.all(n.map((function(e){return q(e)})));case 13:return r=e.sent,console.log(r),u({message:"Finishing to save to local database"}),e.next=18,G(Object(h.a)({},c,{downloadDisabled:!0,uploadDisabled:!1,deleteDisabled:!1}));case 18:s=e.sent,o(s),u({loading:!1,message:"Loaded ".concat(n.length," work orders and tasks successfuly")}),e.next=24;break;case 23:u({loading:!1,message:"There are no work orders to load from server"});case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(1),console.error(e.t0),u({loading:!1,error:!0,message:"Error loading work orders from server. Please try again"});case 30:case"end":return e.stop()}}),e,null,[[1,26]])})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(b.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u({loading:!0,message:"Syncing work orders back to server"}),u({message:"Finishing sync back to server"}),e.next=5,G(Object(h.a)({},c,{downloadDisabled:!0,uploadDisabled:!0,deleteDisabled:!1}));case 5:a=e.sent,o(a),u({loading:!1,message:"Work orders synced back to server successfuly"}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),u({loading:!1,error:!0,message:"Error syncing work orders back to server. Please try again"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(b.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u({loading:!0,message:"Cleaning local database"}),e.next=4,Q();case 4:return u({message:"Finishing the cleaning of the local database"}),e.next=7,G(Object(h.a)({},c,{downloadDisabled:!1,uploadDisabled:!0,deleteDisabled:!0}));case 7:a=e.sent,o(a),u({loading:!1,message:"Local database cleaned successfuly"}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),u({loading:!1,error:!0,message:"Error cleaning the local database. Please try again"});case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:e.root},r.a.createElement(E.a,{container:!0,spacing:2},r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(g.a,{variant:"h5"},"Home")),r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(ce.a,{variant:"contained",color:"default",className:e.button,startIcon:r.a.createElement(ue.a,null),onClick:d,disabled:c.downloadDisabled},"Download")),r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(ce.a,{variant:"contained",color:"default",className:e.button,startIcon:r.a.createElement(ie.a,null),onClick:p,disabled:c.uploadDisabled},"Upload")),r.a.createElement(E.a,{item:!0,xs:12},r.a.createElement(ce.a,{variant:"contained",color:"default",className:e.button,startIcon:r.a.createElement(pe.a,null),onClick:m,disabled:c.deleteDisabled},"Delete")),r.a.createElement(E.a,{item:!0,xs:12},l.loading&&r.a.createElement(oe.a,{size:17}),"  ",l.message&&r.a.createElement("span",null,l.message))))}var Ee=Object(l.a)((function(e){return{main:{paddingTop:e.spacing(2)}}}));function we(){var e=Ee();return r.a.createElement(d.a,{basename:"/tp-poc-react-pwa"},r.a.createElement(s.a,null),r.a.createElement(u.a,null),r.a.createElement(i.a,{maxWidth:"md"},r.a.createElement("main",{className:e.main},r.a.createElement(p.c,null,r.a.createElement(p.a,{exact:!0,path:"/"},r.a.createElement(ge,null)),r.a.createElement(p.a,{path:"/orders"},r.a.createElement(re,null))))))}var ye=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ke(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(r.a.createElement(we,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/tp-poc-react-pwa",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/tp-poc-react-pwa","/sw.js");ye?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ke(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ke(t,e)}))}}()},63:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return h}));var n=a(14),r=a(0),c=a.n(r),o=a(79),s=a(106),i=a(108),l=a(40),u=a(109),d=a(71),p=a.n(d),m=a(111),f=a(64),b=Object(o.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function h(){var t=b(),a=e.browser&&/iPad|iPhone|iPod/.test(navigator.userAgent),o=Object(r.useState)(!1),d=Object(n.a)(o,2),h=d[0],v=d[1],g=function(e){return function(t){(!t||"keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&h!==e&&v(e)}};return c.a.createElement("div",{className:t.root},c.a.createElement(s.a,{position:"static"},c.a.createElement(m.a,{anchor:"left",open:h,onOpen:g(!0),onClose:g(!1),disableBackdropTransition:!a,disableDiscovery:a},c.a.createElement(f.a,null)),c.a.createElement(i.a,null,c.a.createElement(u.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",onClick:g(!0)},c.a.createElement(p.a,null)),c.a.createElement(l.a,{variant:"h6",className:t.title},"My Work App"))))}}).call(this,a(60))},64:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a(0),r=a.n(n),c=a(102),o=a(103),s=a(104),i=a(79),l=a(105),u=a(69),d=a.n(u),p=a(70),m=a.n(p),f=a(30);function b(e){var t=e.icon,a=e.primary,n=e.to,i=r.a.useMemo((function(){return r.a.forwardRef((function(e,t){return r.a.createElement(f.b,Object.assign({to:n,ref:t},e))}))}),[n]);return r.a.createElement("li",null,r.a.createElement(c.a,{button:!0,component:i},t?r.a.createElement(o.a,null,t):null,r.a.createElement(s.a,{primary:a})))}var h=Object(i.a)((function(e){return{root:{flexGrow:1,width:180}}}));function v(){var e=h();return r.a.createElement("div",{className:e.root},r.a.createElement(l.a,null,r.a.createElement(b,{to:"/",primary:"Home",icon:r.a.createElement(d.a,null)}),r.a.createElement(b,{to:"/orders",primary:"Orders",icon:r.a.createElement(m.a,null)})))}},86:function(e,t,a){e.exports=a(100)},91:function(e,t,a){}},[[86,1,2]]]);
//# sourceMappingURL=main.91fa20d9.chunk.js.map