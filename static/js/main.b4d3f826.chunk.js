(this["webpackJsonptest-01"]=this["webpackJsonptest-01"]||[]).push([[0],{100:function(e,t,a){e.exports=a(124)},105:function(e,t,a){},124:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),o=a.n(c),s=(a(105),a(168)),i=a(169),l=a(93),u=a(74),p=a(31),m=a(32),d=a(5),f=a.n(d),b=a(92),h=a(27),v=a(8),g=a(20),E=a(45),y=a(160),k=a(133),x=a(131),w=a(129),j=a(161),O=a(126),S=a(128),_=a(162),D=a(170),L=a(163),P=a(164),N=a(165),I=a(84),C=a.n(I),R=a(83),A=a.n(R),F=a(85),G=a.n(F),T=a(44),W=a(91),B=a(63),U=a(64);function M(e,t,a,n){var r=e+t/60+a/3600;return"S"!==n&&"W"!==n||(r*=-1),r}function H(e){return new Promise((function(t,a){U.getData(e,(function(){var e=U.getAllTags(this);console.log("==>> EXIF ALL",e),t(function(e){var t=e.GPSLatitude,a=e.GPSLatitudeRef,n=e.GPSLongitude,r=e.GPSLongitudeRef;if(!t||!a||!n||!r)return null;var c=t[0],o=t[1],s=t[2],i=a,l=n[0],u=n[1],p=n[2],m=r;return{lat:M(c,o,s,i),lng:M(l,u,p,m)}}(e))}))}))}B.characters("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$@"),T.a.plugin(W.a);var J,q,z,V={_id:"default",downloadDisabled:!1,downloadedAt:"",uploadDisabled:!0,uploadedAt:"",deleteDisabled:!0,deletedAt:""};function X(){return J||(J=new T.a("sync-metadata")),J}function K(){return q||(q=new T.a("orders")),q}function Q(){return z||(z=new T.a("images")).createIndex({index:{fields:["orderId"]}}),z}function Y(){return Z.apply(this,arguments)}function Z(){return(Z=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X().get("default");case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!e.t0||"not_found"!==e.t0.name){e.next=10;break}return e.abrupt("return",V);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function $(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(v.a)(f.a.mark((function e(t){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y();case 2:return a=e.sent,n=a&&a._rev?Object(h.a)({},t,{_rev:a._rev}):t,e.next=6,X().put(n);case 6:return e.next=8,X().get("default");case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(){return ae.apply(this,arguments)}function ae(){return(ae=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K().allDocs({include_docs:!0});case 2:return t=e.sent,e.abrupt("return",t.rows.map((function(e){return e.doc})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return re.apply(this,arguments)}function re(){return(re=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K().get(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){return oe.apply(this,arguments)}function oe(){return(oe=Object(v.a)(f.a.mark((function e(t){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.id&&(a=Object(h.a)({},t,{_id:t.id})),e.next=3,K().put(a);case 3:return n=e.sent,e.abrupt("return",ne(n.id));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return ie.apply(this,arguments)}function ie(){return(ie=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K().destroy();case 2:return(t=e.sent).ok&&(q=null),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e){return ue.apply(this,arguments)}function ue(){return(ue=Object(v.a)(f.a.mark((function e(t){var a,n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q().find({selector:{orderId:t}});case 2:return a=e.sent,n=a.docs.map((function(e){return e._id})),e.next=6,Q().allDocs({keys:n,include_docs:!0,attachments:!0,binary:!0});case 6:return r=e.sent,e.abrupt("return",r.rows.map((function(e){return e.doc})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return me.apply(this,arguments)}function me(){return(me=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q().get(t,{attachments:!0,binary:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e,t){return fe.apply(this,arguments)}function fe(){return(fe=Object(v.a)(f.a.mark((function e(t,a){var n,r,c,o,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.name,r=a.type,e.prev=1,!r.includes("image")){e.next=8;break}return e.next=5,H(a);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=null;case 9:return c=e.t0,o={_id:B.generate(),orderId:t,name:n,location:c,_attachments:{file:{content_type:r,data:a}}},e.next=13,Q().put(o);case 13:return s=e.sent,e.abrupt("return",pe(s.id));case 17:e.prev=17,e.t1=e.catch(1),console.error(e.t1);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}var be=Object(l.a)((function(e){return{root:{},inputFile:{display:"none"},icon:{color:"rgba(255, 255, 255, 0.54)"}}}));function he(){var e=be(),t=Object(m.f)().id,a=Object(n.useState)(!1),c=Object(g.a)(a,2),o=c[0],s=c[1],i=Object(n.useState)(!1),l=Object(g.a)(i,2),u=l[0],p=l[1],d=Object(n.useState)(),I=Object(g.a)(d,2),R=I[0],F=I[1],T=Object(n.useState)([]),W=Object(g.a)(T,2),B=W[0],U=W[1];function M(){return(M=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),s(!1),e.prev=2,e.next=5,ne(t);case 5:a=e.sent,F(a),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),s(!0);case 13:p(!1);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function H(){return(H=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),s(!1),e.prev=2,e.next=5,le(t);case 5:a=e.sent,console.log(a),U(a),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.error(e.t0),s(!0);case 14:p(!1);case 15:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}Object(n.useEffect)((function(){!function(e){M.apply(this,arguments)}(t)}),[]),Object(n.useEffect)((function(){!function(e){H.apply(this,arguments)}(t)}),[]);var J=function(e){return function(t){console.log("Task: ",e.id,", done: ",t.target.checked),F(Object(h.a)({},R,{tasks:R.tasks.map((function(a){return e.id===a.id?Object(h.a)({},a,{done:t.target.checked}):a}))}))}},q=function(){var e=Object(v.a)(f.a.mark((function e(t){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=document.getElementById("icon-button-file")).files||!a.files[0]){e.next=6;break}return e.next=4,de(R._id,a.files[0]);case 4:n=e.sent,U([].concat(Object(b.a)(B),[n]));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,o&&r.a.createElement("div",null,"Something went wrong ..."),u&&r.a.createElement("div",null,"Loading..."),!u&&!R&&r.a.createElement(E.a,{variant:"subtitle1"},"Order not found"),R&&r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(E.a,{variant:"h5"},R.description)),r.a.createElement(y.a,{item:!0,container:!0,xs:12,direction:"row",justify:"flex-end"},r.a.createElement(y.a,{item:!0},r.a.createElement(k.a,{color:"primary",component:"span"},r.a.createElement(A.a,null)))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(x.a,{elevation:1},r.a.createElement(w.a,{subheader:r.a.createElement(j.a,{color:"primary"},"Tasks")},R.tasks.map((function(e){return r.a.createElement(O.a,{key:e.id},r.a.createElement(S.a,{primary:e.description}),r.a.createElement(_.a,null,r.a.createElement(D.a,{edge:"end",onChange:J(e),checked:e.done})))}))))),r.a.createElement(y.a,{item:!0,container:!0,xs:12,direction:"row",justify:"flex-end"},r.a.createElement(y.a,{item:!0},r.a.createElement("input",{type:"file",accept:"image/*,video/*",id:"icon-button-file",className:e.inputFile,onChange:q}),r.a.createElement("label",{htmlFor:"icon-button-file"},r.a.createElement(k.a,{color:"primary",component:"span"},r.a.createElement(C.a,null))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(x.a,{elevation:1},r.a.createElement(L.a,{cellHeight:180,cols:3},r.a.createElement(P.a,{key:"Subheader",cols:3,style:{height:"auto"}},r.a.createElement(j.a,{component:"div",color:"primary"},"Images")),B&&B.filter((function(e){return e._attachments.file.content_type.includes("image/")})).map((function(t){return r.a.createElement(P.a,{key:t._id,cols:1},r.a.createElement("img",{src:URL.createObjectURL(t._attachments.file.data),alt:t.name}),r.a.createElement(N.a,{title:t.name,subtitle:t.location?"".concat(t.location.lat,", ").concat(t.location.lng):"No location",actionIcon:t.location?r.a.createElement(k.a,{className:e.icon,onClick:(a=t.location,function(e){if(console.log("==>> onClickMap",a),a){var t=a.lat,n=a.lng;return["iPhone","iPad","iPod"].includes(navigator.platform)?window.open("maps://maps.google.com/maps?daddr=".concat(t,",").concat(n,"&amp;ll="),"_top").focus():window.open("https://maps.google.com/maps?q=".concat(t,",").concat(n),"_blank").focus()}})},r.a.createElement(G.a,null)):null}));var a})),r.a.createElement(P.a,{key:"Subheader",cols:3,style:{height:"auto"}},r.a.createElement(j.a,{component:"div",color:"primary"},"Videos")),B&&B.filter((function(e){return e._attachments.file.content_type.includes("video/")})).map((function(e){return r.a.createElement(P.a,{key:e._id,cols:1},r.a.createElement("video",{height:180,controls:!0,src:URL.createObjectURL(e._attachments.file.data)}))})))))))}var ve=a(86),ge=a.n(ve);function Ee(){var e=Object(m.g)().url,t=Object(n.useState)(!1),a=Object(g.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(!1),i=Object(g.a)(s,2),l=i[0],u=i[1],d=Object(n.useState)([]),b=Object(g.a)(d,2),h=b[0],j=b[1];function D(){return(D=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(!0),o(!1),e.prev=2,e.next=5,te();case 5:t=e.sent,j(t),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),o(!0);case 13:u(!1);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}return Object(n.useEffect)((function(){!function(){D.apply(this,arguments)}()}),[]),r.a.createElement("div",null,r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(E.a,{variant:"h5"},"Work Orders")),r.a.createElement(y.a,{item:!0,xs:12},c&&r.a.createElement("div",null,"Something went wrong ..."),l&&r.a.createElement("div",null,"Loading..."),!l&&0===h.length&&r.a.createElement(E.a,{variant:"subtitle1"},"No orders to display"),h.length>0&&r.a.createElement(x.a,{elevation:1},r.a.createElement(w.a,null,h.map((function(t){return r.a.createElement(O.a,{key:t.id,button:!0,component:p.b,to:"".concat(e,"/").concat(t.id)},r.a.createElement(S.a,{primary:t.description,secondary:t.station}),r.a.createElement(_.a,null,r.a.createElement(k.a,{color:"inherit"},r.a.createElement(ge.a,null))))})))))))}function ye(){var e=Object(m.g)().path;return r.a.createElement(m.c,null,r.a.createElement(m.a,{exact:!0,path:e},r.a.createElement(Ee,null)),r.a.createElement(m.a,{path:"".concat(e,"/:id")},r.a.createElement(he,null)))}var ke=a(166),xe=a(167),we=a(88),je=a.n(we),Oe=a(87),Se=a.n(Oe),_e=a(89),De=a.n(_e);function Le(){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://tp-poc-api.herokuapp.com/api/orders");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://tp-poc-api.herokuapp.com/api/orders/".concat(t));case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ce=Object(l.a)((function(e){return{root:{},button:{marginRight:e.spacing(2)}}}));function Re(){var e=Ce(),t=Object(n.useState)(V),a=Object(g.a)(t,2),c=a[0],o=a[1];Object(n.useEffect)((function(){function e(){return(e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y();case 3:t=e.sent,o(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s=Object(n.useState)({loading:!1,message:"",err:!1}),i=Object(g.a)(s,2),l=i[0],u=i[1],p=function(){var e=Object(v.a)(f.a.mark((function e(t){var a,n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u({loading:!0,message:"Loading work orders from server"}),e.prev=1,e.next=4,Le();case 4:if(!((a=e.sent).length>0)){e.next=22;break}return u({message:"Loading tasks for ".concat(a.length," work orders from server")}),e.next=9,Promise.all(a.map((function(e){return Ne(e.id)})));case 9:return n=e.sent,u({message:"Saving work orders to local database"}),e.next=13,Promise.all(n.map((function(e){return ce(e)})));case 13:return e.sent,u({message:"Finishing to save to local database"}),e.next=17,$(Object(h.a)({},c,{downloadDisabled:!0,uploadDisabled:!1,deleteDisabled:!1}));case 17:r=e.sent,o(r),u({loading:!1,message:"Loaded ".concat(n.length," work orders and tasks successfuly")}),e.next=23;break;case 22:u({loading:!1,message:"There are no work orders to load from server"});case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(1),console.error(e.t0),u({loading:!1,error:!0,message:"Error loading work orders from server. Please try again"});case 29:case"end":return e.stop()}}),e,null,[[1,25]])})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u({loading:!0,message:"Syncing work orders back to server"}),u({message:"Finishing sync back to server"}),e.next=5,$(Object(h.a)({},c,{downloadDisabled:!0,uploadDisabled:!0,deleteDisabled:!1}));case 5:a=e.sent,o(a),u({loading:!1,message:"Work orders synced back to server successfuly"}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),u({loading:!1,error:!0,message:"Error syncing work orders back to server. Please try again"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u({loading:!0,message:"Cleaning local database"}),e.next=4,se();case 4:return u({message:"Finishing the cleaning of the local database"}),e.next=7,$(Object(h.a)({},c,{downloadDisabled:!1,uploadDisabled:!0,deleteDisabled:!0}));case 7:a=e.sent,o(a),u({loading:!1,message:"Local database cleaned successfuly"}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),u({loading:!1,error:!0,message:"Error cleaning the local database. Please try again"});case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:e.root},r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(E.a,{variant:"h5"},"Home")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ke.a,{variant:"contained",color:"default",className:e.button,startIcon:r.a.createElement(Se.a,null),onClick:p,disabled:c.downloadDisabled},"Download")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ke.a,{variant:"contained",color:"default",className:e.button,startIcon:r.a.createElement(je.a,null),onClick:m,disabled:c.uploadDisabled},"Upload (Not Working)")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ke.a,{variant:"contained",color:"default",className:e.button,startIcon:r.a.createElement(De.a,null),onClick:d,disabled:c.deleteDisabled},"Delete")),r.a.createElement(y.a,{item:!0,xs:12},l.loading&&r.a.createElement(xe.a,{size:17}),"  ",l.message&&r.a.createElement("span",null,l.message))))}var Ae=Object(l.a)((function(e){return{main:{paddingTop:e.spacing(2)}}}));function Fe(){var e=Ae();return r.a.createElement(p.a,{basename:"/"},r.a.createElement(s.a,null),r.a.createElement(u.a,null),r.a.createElement(i.a,{maxWidth:"md"},r.a.createElement("main",{className:e.main},r.a.createElement(m.c,null,r.a.createElement(m.a,{exact:!0,path:"/"},r.a.createElement(Re,null)),r.a.createElement(m.a,{path:"/orders"},r.a.createElement(ye,null))))))}var Ge=a(90),Te=a.n(Ge);o.a.render(r.a.createElement(Fe,null),document.getElementById("root")),Te()({brandName:"My Work"})},74:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return h}));var n=a(20),r=a(0),c=a.n(r),o=a(93),s=a(130),i=a(132),l=a(45),u=a(133),p=a(82),m=a.n(p),d=a(135),f=a(75),b=Object(o.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function h(){var t=b(),a=e.browser&&/iPad|iPhone|iPod/.test(navigator.userAgent),o=Object(r.useState)(!1),p=Object(n.a)(o,2),h=p[0],v=p[1],g=function(e){return function(t){(!t||"keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&h!==e&&v(e)}};return c.a.createElement("div",{className:t.root},c.a.createElement(s.a,{position:"static"},c.a.createElement(d.a,{anchor:"left",open:h,onOpen:g(!0),onClose:g(!1),disableBackdropTransition:!a,disableDiscovery:a},c.a.createElement(f.a,null)),c.a.createElement(i.a,null,c.a.createElement(u.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",onClick:g(!0)},c.a.createElement(m.a,null)),c.a.createElement(l.a,{variant:"h6",className:t.title},"My Work App"))))}}).call(this,a(69))},75:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a(0),r=a.n(n),c=a(126),o=a(127),s=a(128),i=a(93),l=a(129),u=a(80),p=a.n(u),m=a(81),d=a.n(m),f=a(31);function b(e){var t=e.icon,a=e.primary,n=e.to,i=r.a.useMemo((function(){return r.a.forwardRef((function(e,t){return r.a.createElement(f.b,Object.assign({to:n,ref:t},e))}))}),[n]);return r.a.createElement("li",null,r.a.createElement(c.a,{button:!0,component:i},t?r.a.createElement(o.a,null,t):null,r.a.createElement(s.a,{primary:a})))}var h=Object(i.a)((function(e){return{root:{flexGrow:1,width:180}}}));function v(){var e=h();return r.a.createElement("div",{className:e.root},r.a.createElement(l.a,null,r.a.createElement(b,{to:"/",primary:"Home",icon:r.a.createElement(p.a,null)}),r.a.createElement(b,{to:"/orders",primary:"Orders",icon:r.a.createElement(d.a,null)})))}}},[[100,1,2]]]);
//# sourceMappingURL=main.b4d3f826.chunk.js.map